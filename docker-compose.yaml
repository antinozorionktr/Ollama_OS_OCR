version: "3.9"

services:
  docvision-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: docvision-api
    restart: unless-stopped

    ports:
      - "8002:8002"

    volumes:
      # Document folders (read-only)
      - /home/priyanshu/Desktop/Mistral3OCR/Data/Invoice:/data/Invoice:ro
      - /home/priyanshu/Desktop/Mistral3OCR/Data/Contract:/data/Contract:ro
      - /home/priyanshu/Desktop/Mistral3OCR/Data/Crac:/data/Crac:ro
      # Persistent storage
      - ./data:/app/data
      - ./logs:/app/logs
      - ./docx_outputs:/app/data/docx_outputs

    environment:
      - OLLAMA_BASE_URL=http://host.docker.internal:11434
      # - OLLAMA_MODEL=mistral-small3.1:24b-2503-fp16
      - OLLAMA_MODEL=ministral-3:14b
      - OLLAMA_TIMEOUT=300
      - INVOICE_DIR=/data/Invoice
      - CONTRACT_DIR=/data/Contract
      - CRAC_DIR=/data/Crac
      - DB_PATH=/app/data/docvision.db
      - DOCX_OUTPUT_DIR=/app/data/docx_outputs
      - LOG_DIR=/app/logs
      - CORS_ORIGINS=*

    extra_hosts:
      - "host.docker.internal:host-gateway"

    deploy:
      resources:
        limits:
          memory: 4G